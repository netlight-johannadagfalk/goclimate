<div class="callout max-w-md mx-auto" data-controller="registration-form membership-choice">
  <a id="sign-up" class="absolute -mt-32"></a>
  <div class="space-y-3" data-controller="registration-price" data-target="membership-choice.priceControllerElement">
    <h2 class="text-lg d:text-xl font-semibold text-center"><%= t 'views.registrations.sign_up_heading' %></h2>
    <p class="text-sm text-center mb-6 hidden"><%= t 'views.registrations.step' %> 1/2</p>
    <p class="text-center"><%= t 'views.registrations.sign_up_description' %></p>
    <input type="checkbox" id="step-one-done" class="toggler">

    <div class="toggler-checked:hidden">
      <div class="space-y-3">
        <div class="h-px w-full bg-gray-tint-2 hidden"></div>
        <%= form_with method: :get, class: 'space-y-3', html: { 'data-target': 'registration-price.peopleForm', 'data-url': new_user_registration_path } do |f| %>
          <%= f.hidden_field(:lifestyle_footprint, :value => @footprint.key) %>
          <label class="flex flex-row items-center p-3 bg-gray-pastel rounded cursor-pointer"
            data-active-class="flex flex-row items-center p-3 bg-green-tint-1 rounded cursor-pointer"
            data-inactive-class="flex flex-row items-center p-3 bg-gray-pastel rounded cursor-pointer"
            for="free"
            >
            <input class="flex-shrink-0 mr-2" type="radio" name="membership" id="free" value="free" data-target="membership-choice.choice" data-action="click->membership-choice#handleChange">
            <span><%= t('views.registrations.membership.free').gsub('<span', '<span class="font-bold"').html_safe %></span>
          </label>
          <label class="flex flex-row items-center p-3 bg-green-tint-1 rounded cursor-pointer"
            data-active-class="flex flex-row items-center p-3 bg-green-tint-1 rounded cursor-pointer"
            data-inactive-class="flex flex-row items-center p-3 bg-gray-pastel rounded cursor-pointer"
            for="single"
            >
            <input class="flex-shrink-0 mr-2" type="radio" name="membership" id="single" value="single" checked data-target="membership-choice.choice" data-action="click->membership-choice#handleChange">
            <span><%= t('views.registrations.membership.single').gsub('<span', '<span class="font-bold"').html_safe %></span>
          </label>
          <label class="flex flex-row items-center p-3 bg-gray-pastel rounded cursor-pointer"
            data-active-class="flex flex-row items-center p-3 bg-green-tint-1 rounded cursor-pointer"
            data-inactive-class="flex flex-row items-center p-3 bg-gray-pastel rounded cursor-pointer"
            for="multi"
            >
            <input class="flex-shrink-0 mr-2" type="radio" name="membership" id="multi" value="multi" data-target="membership-choice.choice" data-action="click->membership-choice#handleChange">
            <span><%= t('views.registrations.membership.multi').gsub('<span', '<span class="font-bold"').html_safe %></span>
            <div class="select-wrapper flex-shrink-0">
                <%= f.select :people,
                  options_for_select(2..20, params[:people].presence || 2),
                  {},
                  { class: 'select', 'data-action': 'change->membership-choice#chooseMulti' }
                %>
            </div>
          </label>
        <% end %>
        <div class="h-px w-full bg-gray-tint-2 hidden"></div>

        <div class="py-6 space-y-1">
          <p class="heading-lg text-center">
            <span data-target="membership-choice.subscriptionInfo" data-active-class="inline" data-inactive-class="hidden">
              <span data-target="registration-price.price"><%= @plan_price.to_s(precision: :auto) %></span>/<%= t 'months.one' %>
            </span>
            <span class="hidden" data-target="membership-choice.noSubscriptionInfo" data-active-class="inline" data-inactive-class="hidden"><%= t 'views.registrations.price_free' %></span>
          </p>

          <p class="text-center text-sm" data-target="membership-choice.subscriptionInfo" data-active-class="text-center text-sm block" data-inactive-class="text-center text-sm hidden">
            <a href="#where-does-the-money-go" class="link inline" data-controller="scroll-to" data-action="scroll-to#scroll"><%= t 'views.registrations.where_does_the_money_go.heading' %></a>
          </p>
        </div>

        <label for="step-one-done" id="continue-to-payment" class="button button-cta w-full">
          <span data-target="membership-choice.subscriptionInfo" data-active-class="inline" data-inactive-class="hidden"><%= t 'views.registrations.continue_to_payment' %></span>
          <span class="hidden" data-target="membership-choice.noSubscriptionInfo" data-active-class="inline" data-inactive-class="hidden"><%= t 'views.registrations.continue' %></span>
        </label>
        <p class="text-sm text-right"><%= t 'views.registrations.step' %> 1/2</p>
      </div>
    </div>

    <div class="toggler-not-checked:hidden">
      <p class="text-sm text-center mb-6 hidden"><%= t 'views.registrations.step' %> 2/2</p>

      <%= form_with url: registration_path(resource_name, format: :json), html: { 'data-target': 'registration-form.form' } do |f| %>
        <%= f.hidden_field(:lifestyle_footprint, :value => @footprint&.key) %>
        <%= f.hidden_field :people, value: (params[:people].presence || 1), 'data-target': 'registration-price.peopleField' %>
        <%= f.hidden_field :membership, value: '', 'data-target': 'membership-choice.membershipField' %>
        <%= fields_for @user do |user_form| %>
          <%= user_form.hidden_field :region %>

          <label for="email" class="block font-semibold"><%=t 'email' %></label>
          <%= user_form.email_field :email, required: true, id: "email", class: "input w-full" %>

          <label for="password" class="block font-semibold mt-3"><%=t 'password' %></label>
          <%= user_form.password_field :password, required: true, minlength: '6', maxlength: '128', size: 'auto', autocomplete: "off", id: "password", class: "input w-full" %>

          <div class="mt-3" data-controller="stripe-card-element" data-target="registration-form.stripeCardElement membership-choice.stripeCardElement" data-active-class="mt-3 block" data-inactive-class="hidden">
            <label for="card" class=" font-semibold"><%=t 'credit_or_debit_card' %></label>
            <div class="">
              <div id="card" class="input mb-1" data-target="stripe-card-element.container"></div>
              <div class="text-orange-shade-1" data-target="stripe-card-element.errors"></div>
              <i class="fa fa-lock" aria-hidden="true"></i> <span class="ml-1">Secured by Stripe</span>
              <%= f.hidden_field :payment_method_id, 'data-target': 'stripe-card-element.paymentMethodField' %>
            </div>
          </div>

          <div class="mt-3">
            <label>
              <%= f.check_box :privacy_policy, 'data-target': 'registration-form.privacyPolicyAgreement', 'data-action': 'change->registration-form#updateSubmitButton' %>
              <span>
                <%=t 'i_accept' %>
                <%= link_to I18n.t('our_privacy_policy'), privacy_policy_path, target: '_blank', class: 'link' %>
              </span>
            </label>
          </div>
        <% end %>
      <% end %>

      <div class="py-6 space-y-1">
        <p class="heading-lg text-center">
          <span data-target="membership-choice.subscriptionInfo" data-active-class="inline" data-inactive-class="hidden">
            <span data-target="registration-price.price"><%= @plan_price.to_s(precision: :auto) %></span>/<%= t 'months.one' %>
          </span>
          <span class="hidden" data-target="membership-choice.noSubscriptionInfo" data-active-class="inline" data-inactive-class="hidden"><%= t 'views.registrations.price_free' %></span>
        </p>

        <p class="text-center text-sm" data-target="membership-choice.subscriptionInfo" data-active-class="text-center text-sm block" data-inactive-class="text-center text-sm hidden">
          <a href="#where-does-the-money-go" class="link inline" data-controller="scroll-to" data-action="scroll-to#scroll"><%= t 'views.registrations.where_does_the_money_go.heading' %></a>
        </p>
      </div>

      <button class="button button-cta w-full"
        data-target="registration-form.submitButton membership-choice.subscriptionInfo"
        data-action="registration-form#submitWithCardDetails"
        data-active-class="button button-cta w-full block"
        data-inactive-class="hidden"
      >
        <i class="fa fa-spinner fa-spin hidden" data-target="registration-form.loadingIndicator"></i>
        <span><%= t 'views.registrations.start_subscription' %></span>
      </button>

      <button class="button button-cta w-full hidden"
        data-target="registration-form.submitButton membership-choice.noSubscriptionInfo"
        data-action="registration-form#submit"
        data-active-class="button button-cta block w-full"
        data-inactive-class="hidden"
      >
        <i class="fa fa-spinner fa-spin hidden" data-target="registration-form.loadingIndicator"></i>
        <span><%= t 'views.registrations.create_account' %></span>
      </button>
      <p class="text-orange-shade-1 ml-4" data-target="registration-form.errorMessage"></p>
      <div class="mt-3 flex justify-between">
        <div><label for="step-one-done" class="link-ui text-sm"><- <%= t 'views.registrations.back' %></label></div>
        <span class="text-sm"><%= t 'views.registrations.step' %> 2/2</span>
      </div>
    </div>
  </div>  
</div>
